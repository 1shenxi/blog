# HTTP

记录一下关于 http 的一些东西

说http前，了解一个老生常谈的面试问题：
`在浏览器中输入url，按下回车到页面渲染都有哪些过程？`

## 0. url到页面渲染过程

### 0.1 url 解析

- 解析：判断搜索的地址还是一个关键词。
- HSTS: HTTP严格传输安全。
  - p.s. 强制使用Https请求，当请求了第一次之后(无论http还是https)，最终重定向到https请求，然后响应头中会含有`Strict-Transport-Security` 字段，之后到请求，如果发现是http，都会变成 https 的请求方式.(当然是可以设置`max-age`)
- 其他操作：访问的安全检查，亦或者访问限制。(例如浏览器会限制访问哪些网站等等)
- 检查缓存：如果是强缓存(`200`)，则不会再次请求。如果是协商缓存(`304`)，则会发一个请求去确认缓存的时效性。

### 0.2 DNS查询

*DNS (Domain Name System)*: 是一个基于UDP协议的域名系统，负责把域名解析成IP.

真正请求地址应该是IP地址，而不是域名。所以，第一步会判断是不是非IP地址。
如若是域名，则会去查询正在的IP地址后再访问。

#### 0.2.1 浏览器缓存

谷歌可以通过访问：[chrome://net-internals/#dns](chrome://net-internals/#dns) 来看浏览器对DNS的缓存;

#### 0.2.2 系统缓存

本地 hosts 文件下可以有`域名`对应`IP`的配置，如果，没有命中；则会去DNS服务器发起查询请求。

#### 0.2.3 路由器缓存

这个没什么好说的，路由器可以设置。

#### 0.2.4 ISP DNS 缓存

就是用户电脑可以设置DNS服务器的IP地址，通过这些运营商的DNS服务器解析

#### 0.2.5 根域名服务器查询

### 0.3 TCP 连接

### 0.4 处理请求

### 0.5 接受响应

### 0.6 渲染页面

## 1. HTTP 的通讯过程

## 2. HTTPS

### 2.1 https 解决的问题

- 信息加密传输：第三方无法窃听。
- 校验机制：一旦被篡改，通信双方会立刻发现。
- 身份证书：防止身份被冒充。

### 2.2 https 连接过程

1. 客户端请求服务器获取证书公钥
2. 客户端(SSL/TLS)解析证书（无效会弹出警告）
3. 生成随机值
4. 用公钥加密随机值生成密钥
5. 客户端将秘钥发送给服务器
6. 服务端用私钥解密秘钥得到随机值
7. 将信息和随机值混合在一起进行对称加密
8. 将加密的内容发送给客户端
9. 客户端用秘钥解密信息

- 服务端有：公钥，私钥。
- 当客户端请求，返回公钥给客户端。
- 客户端验证证书是否有效。
  - 无效
    - 弹出警告
  - 有效
    - 生成一个随机值
    - 用公钥加密随机值返回给服务端
    - 服务端用私钥解密私钥，得到随机值
    - 用随机值对信息进行对称加密，发送给客户端
    - 客户端用公钥解密后，得到对称加密的信息，用随机值对内容进行解密。

[1](https://zhuanlan.zhihu.com/p/80551769)

[2](http://www.dailichun.com/2018/03/12/whenyouenteraurl.html)
